<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cart — KTD Dropshipping</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-gray-50 font-inter">
    <header class="bg-white shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
        <a href="index.html" class="flex items-center gap-3 text-teal-600 font-semibold">KTD Dropshipping</a>
        <a href="index.html" class="text-sm text-gray-600 hover:underline">Continue shopping</a>
      </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <h1 class="text-2xl font-semibold mb-6">Your Cart</h1>
      <div id="cartContainer" class="space-y-4">
        <!-- Items will be injected here -->
      </div>

      <div id="emptyState" class="text-center text-gray-500 py-12">
        Your cart is empty. <a href="index.html" class="text-teal-600 hover:underline">Start shopping</a>
      </div>

      <div id="cartSummary" class="mt-8 bg-white p-4 rounded shadow hidden">
        <div class="flex items-center justify-between">
          <div class="text-lg font-semibold">Total</div>
          <div id="cartTotal" class="text-lg font-bold text-teal-600">₹0</div>
        </div>
        <div class="mt-4 flex gap-3">
          <button id="checkoutBtn" class="px-4 py-2 bg-teal-600 text-white rounded">Checkout</button>
          <button id="clearBtn" class="px-4 py-2 border rounded">Clear cart</button>
        </div>
      </div>
    </main>

    <script>
      function formatPrice(text){
        // try to extract digits from text like '₹1,199' or '₹1,199 <span>...'
        if(!text) return 0;
        const num = text.replace(/[^0-9.]/g,'');
        return Number(num) || 0;
      }

      function renderCart(){
        const container = document.getElementById('cartContainer');
        const empty = document.getElementById('emptyState');
        const summary = document.getElementById('cartSummary');
        const totalEl = document.getElementById('cartTotal');
        let cart = [];
        try{ cart = JSON.parse(localStorage.getItem('ktd_cart') || '[]') }catch(e){ cart = []; }
        container.innerHTML = '';
        if(!cart || cart.length === 0){
          empty.style.display = 'block';
          summary.classList.add('hidden');
          return;
        }
        empty.style.display = 'none';
        summary.classList.remove('hidden');

        let total = 0;
        cart.forEach(item=>{
          const priceVal = formatPrice(item.price);
          total += priceVal * (item.qty || 1);
          const div = document.createElement('div');
          div.className = 'flex items-center gap-4 bg-white p-4 rounded shadow';
          div.innerHTML = `
            <img src="${item.img}" class="w-24 h-24 object-contain bg-gray-50 rounded" />
            <div class="flex-1">
              <div class="font-semibold">${item.title}</div>
              <div class="text-sm text-gray-500">${item.price}</div>
              <div class="mt-2 flex items-center gap-2">
                <button data-id="${item.id}" class="decrease text-sm px-2 py-1 border rounded">-</button>
                <div class="px-3 py-1 border rounded qty">${item.qty}</div>
                <button data-id="${item.id}" class="increase text-sm px-2 py-1 border rounded">+</button>
                <button data-id="${item.id}" class="remove text-sm px-3 py-1 text-red-600">Remove</button>
              </div>
            </div>
            <div class="text-teal-600 font-bold">₹${(priceVal * (item.qty||1)).toFixed(2)}</div>
          `;
          container.appendChild(div);
        });
        totalEl.textContent = '₹' + total.toFixed(2);

        // wire controls
        document.querySelectorAll('.remove').forEach(btn=>{
          btn.addEventListener('click', (e)=>{
            const id = btn.getAttribute('data-id');
            let c = JSON.parse(localStorage.getItem('ktd_cart') || '[]');
            c = c.filter(i=> i.id !== id);
            localStorage.setItem('ktd_cart', JSON.stringify(c));
            renderCart();
          })
        });
        document.querySelectorAll('.increase').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const id = btn.getAttribute('data-id');
            let c = JSON.parse(localStorage.getItem('ktd_cart') || '[]');
            c = c.map(i=> i.id===id ? {...i, qty: (i.qty||1)+1} : i);
            localStorage.setItem('ktd_cart', JSON.stringify(c));
            renderCart();
          })
        });
        document.querySelectorAll('.decrease').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const id = btn.getAttribute('data-id');
            let c = JSON.parse(localStorage.getItem('ktd_cart') || '[]');
            c = c.map(i=> i.id===id ? {...i, qty: Math.max(1,(i.qty||1)-1)} : i);
            localStorage.setItem('ktd_cart', JSON.stringify(c));
            renderCart();
          })
        });
      }

      document.getElementById('clearBtn').addEventListener('click', ()=>{
        localStorage.removeItem('ktd_cart');
        renderCart();
      });

      document.getElementById('checkoutBtn').addEventListener('click', ()=>{
        alert('Demo checkout — thank you!');
        localStorage.removeItem('ktd_cart');
        renderCart();
        window.location.href = 'index.html';
      });

      // initial render
      renderCart();
    </script>
  </body>
</html>
